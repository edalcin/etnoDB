<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= pageTitle %> - etnoDB</title>
  <link rel="stylesheet" href="/styles/main.css">
  <link rel="stylesheet" href="/styles/presentation/cards.css">
</head>
<body class="min-h-screen bg-gray-50">

  <!-- Header -->
  <header class="bg-forest-700 text-white shadow-lg">
    <div class="container mx-auto px-4 py-6">
      <h1 class="text-3xl font-bold mb-2"><%= contextName %></h1>
      <p class="text-forest-100"><%= contextDescription %></p>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container mx-auto px-4 py-8">

    <!-- Error Message -->
    <% if (typeof error !== 'undefined' && error) { %>
      <div class="mb-6 bg-red-50 border border-red-200 rounded-lg p-4">
        <p class="text-red-800"><%= error %></p>
      </div>
    <% } %>

    <!-- Search Filters -->
    <section class="card mb-8">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Filtros de Busca</h2>

      <form method="GET" action="/" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

          <!-- Community Filter -->
          <div>
            <label class="form-label" for="comunidade">
              Comunidade
            </label>
            <input
              type="text"
              id="comunidade"
              name="comunidade"
              class="form-input"
              value="<%= filters.comunidade %>"
              placeholder="Ex: Ponta do Almada"
            >
          </div>

          <!-- Plant Filter -->
          <div>
            <label class="form-label" for="planta">
              Planta (nome científico ou vernacular)
            </label>
            <input
              type="text"
              id="planta"
              name="planta"
              class="form-input"
              value="<%= filters.planta %>"
              placeholder="Ex: erva-doce, Foeniculum"
            >
          </div>

          <!-- State Filter -->
          <div>
            <label class="form-label" for="estado">
              Estado
            </label>
            <input
              type="text"
              id="estado"
              name="estado"
              class="form-input"
              value="<%= filters.estado %>"
              placeholder="Ex: São Paulo"
            >
          </div>

          <!-- Municipality Filter -->
          <div>
            <label class="form-label" for="municipio">
              Município
            </label>
            <input
              type="text"
              id="municipio"
              name="municipio"
              class="form-input"
              value="<%= filters.municipio %>"
              placeholder="Ex: Ubatuba"
            >
          </div>
        </div>

        <!-- Search Buttons -->
        <div class="flex gap-4">
          <button type="submit" class="btn btn-primary">
            Buscar
          </button>
          <a href="/" class="btn btn-secondary">
            Limpar Filtros
          </a>
        </div>
      </form>
    </section>

    <!-- Results Count -->
    <div class="mb-4 flex items-center justify-between">
      <p class="text-gray-700">
        <% if (pagination.total > 0) { %>
          Encontrados <strong><%= pagination.total %></strong> resultado<%= pagination.total !== 1 ? 's' : '' %>
          <% if (pagination.totalPages > 1) { %>
            (página <%= pagination.page %> de <%= pagination.totalPages %>)
          <% } %>
        <% } else { %>
          Nenhum resultado encontrado
        <% } %>
      </p>

      <% if (results.length > 0) { %>
        <p class="text-sm text-gray-600">
          Mostrando <%= results.length %> referência<%= results.length !== 1 ? 's' : '' %>
        </p>
      <% } %>
    </div>

    <!-- Results Grid -->
    <% if (results.length > 0) { %>
      <div class="results-grid">
        <% results.forEach(reference => { %>
          <%- include('partials/result-card', { reference: reference }) %>
        <% }); %>
      </div>

      <!-- Pagination -->
      <% if (pagination.totalPages > 1) { %>
        <%- include('partials/pagination', { pagination: pagination, filters: filters }) %>
      <% } %>

    <% } else { %>
      <%- include('partials/empty-state', { filters: filters }) %>
    <% } %>

  </main>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white py-6 mt-12">
    <div class="container mx-auto px-4 text-center">
      <p class="text-sm">etnoDB - Base de Dados Etnobotânica</p>
      <p class="text-xs text-gray-400 mt-1">
        Dados de comunidades tradicionais seguindo princípios C.A.R.E.
      </p>
      <% if (showNavigation) { %>
        <div class="mt-3 space-x-4">
          <a href="http://localhost:3001" class="text-forest-300 hover:text-forest-200 text-sm">Entrada de Dados</a>
          <a href="http://localhost:3002" class="text-forest-300 hover:text-forest-200 text-sm">Curadoria</a>
          <a href="http://localhost:3003" class="text-forest-300 hover:text-forest-200 text-sm">Busca Pública</a>
        </div>
      <% } %>
    </div>
  </footer>

</body>
</html>
