<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= pageTitle %> - etnoDB</title>
  <link rel="stylesheet" href="/styles/main.css">
  <link rel="stylesheet" href="/styles/presentation/cards.css">
</head>
<body class="min-h-screen bg-gray-50">

  <!-- Header -->
  <header class="bg-forest-700 text-white shadow-lg">
    <div class="container mx-auto px-4 py-6">
      <h1 class="text-3xl font-bold mb-2"><%= contextName %></h1>
      <p class="text-forest-100"><%= contextDescription %></p>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container mx-auto px-4 py-8">

    <!-- Error Message -->
    <% if (typeof error !== 'undefined' && error) { %>
      <div class="mb-6 bg-red-50 border border-red-200 rounded-lg p-4">
        <p class="text-red-800"><%= error %></p>
      </div>
    <% } %>

    <!-- Search Filters -->
    <section class="card mb-8">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Filtros de Busca</h2>

      <form method="GET" action="/" class="space-y-4">
        <!-- Google-like Search -->
        <div>
          <label class="form-label" for="q">
            Busca Geral
            <span class="text-gray-500 text-xs">- busca em todos os campos</span>
          </label>
          <input
            type="text"
            id="q"
            name="q"
            class="form-input"
            value="<%= filters.q || '' %>"
            placeholder="Digite qualquer termo para buscar em toda a base de dados"
          >
        </div>

        <div class="border-t pt-4">
          <p class="text-sm text-gray-600 mb-3">Ou use os filtros específicos:</p>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

            <!-- Community Type Filter -->
            <div>
              <label class="form-label" for="tipo">
                Tipo de Comunidade
              </label>
              <select
                id="tipo"
                name="tipo"
                class="form-input"
              >
                <option value="">Todos os tipos</option>
                <option value="Andirobeiras" <%= filters.tipo === 'Andirobeiras' ? 'selected' : '' %>>Andirobeiras</option>
                <option value="Apanhadores de sempre-vivas" <%= filters.tipo === 'Apanhadores de sempre-vivas' ? 'selected' : '' %>>Apanhadores de sempre-vivas</option>
                <option value="Caatingueiros" <%= filters.tipo === 'Caatingueiros' ? 'selected' : '' %>>Caatingueiros</option>
                <option value="Caiçaras" <%= filters.tipo === 'Caiçaras' ? 'selected' : '' %>>Caiçaras</option>
                <option value="Castanheiras" <%= filters.tipo === 'Castanheiras' ? 'selected' : '' %>>Castanheiras</option>
                <option value="Catadores de mangaba" <%= filters.tipo === 'Catadores de mangaba' ? 'selected' : '' %>>Catadores de mangaba</option>
                <option value="Ciganos" <%= filters.tipo === 'Ciganos' ? 'selected' : '' %>>Ciganos</option>
                <option value="Cipozeiros" <%= filters.tipo === 'Cipozeiros' ? 'selected' : '' %>>Cipozeiros</option>
                <option value="Extrativistas" <%= filters.tipo === 'Extrativistas' ? 'selected' : '' %>>Extrativistas</option>
                <option value="Faxinalenses" <%= filters.tipo === 'Faxinalenses' ? 'selected' : '' %>>Faxinalenses</option>
                <option value="Geraizeiros" <%= filters.tipo === 'Geraizeiros' ? 'selected' : '' %>>Geraizeiros</option>
                <option value="Ilhéus" <%= filters.tipo === 'Ilhéus' ? 'selected' : '' %>>Ilhéus</option>
                <option value="Indígenas" <%= filters.tipo === 'Indígenas' ? 'selected' : '' %>>Indígenas</option>
                <option value="Isqueiros" <%= filters.tipo === 'Isqueiros' ? 'selected' : '' %>>Isqueiros</option>
                <option value="Morroquianos" <%= filters.tipo === 'Morroquianos' ? 'selected' : '' %>>Morroquianos</option>
                <option value="Pantaneiros" <%= filters.tipo === 'Pantaneiros' ? 'selected' : '' %>>Pantaneiros</option>
                <option value="Pescadores artesanais" <%= filters.tipo === 'Pescadores artesanais' ? 'selected' : '' %>>Pescadores artesanais</option>
                <option value="Piaçaveiros" <%= filters.tipo === 'Piaçaveiros' ? 'selected' : '' %>>Piaçaveiros</option>
                <option value="Pomeranos" <%= filters.tipo === 'Pomeranos' ? 'selected' : '' %>>Pomeranos</option>
                <option value="Povos de terreiro" <%= filters.tipo === 'Povos de terreiro' ? 'selected' : '' %>>Povos de terreiro</option>
                <option value="Quebradeiras de coco babaçu" <%= filters.tipo === 'Quebradeiras de coco babaçu' ? 'selected' : '' %>>Quebradeiras de coco babaçu</option>
                <option value="Quilombolas" <%= filters.tipo === 'Quilombolas' ? 'selected' : '' %>>Quilombolas</option>
                <option value="Retireiros" <%= filters.tipo === 'Retireiros' ? 'selected' : '' %>>Retireiros</option>
                <option value="Ribeirinhos" <%= filters.tipo === 'Ribeirinhos' ? 'selected' : '' %>>Ribeirinhos</option>
                <option value="Seringueiros" <%= filters.tipo === 'Seringueiros' ? 'selected' : '' %>>Seringueiros</option>
                <option value="Vazanteiros" <%= filters.tipo === 'Vazanteiros' ? 'selected' : '' %>>Vazanteiros</option>
                <option value="Veredeiros" <%= filters.tipo === 'Veredeiros' ? 'selected' : '' %>>Veredeiros</option>
              </select>
            </div>

            <!-- Community Filter -->
            <div>
              <label class="form-label" for="comunidade">
                Comunidade
              </label>
              <input
                type="text"
                id="comunidade"
                name="comunidade"
                class="form-input"
                value="<%= filters.comunidade %>"
                placeholder="Ex: Ponta do Almada"
              >
            </div>

            <!-- Plant Filter -->
            <div>
              <label class="form-label" for="planta">
                Planta (nome científico ou vernacular)
              </label>
              <input
                type="text"
                id="planta"
                name="planta"
                class="form-input"
                value="<%= filters.planta %>"
                placeholder="Ex: erva-doce, Foeniculum"
              >
            </div>

            <!-- State Filter -->
            <div>
              <label class="form-label" for="estado">
                Estado
              </label>
              <input
                type="text"
                id="estado"
                name="estado"
                class="form-input"
                value="<%= filters.estado %>"
                placeholder="Ex: São Paulo"
              >
            </div>

            <!-- Municipality Filter -->
            <div>
              <label class="form-label" for="municipio">
                Município
              </label>
              <input
                type="text"
                id="municipio"
                name="municipio"
                class="form-input"
                value="<%= filters.municipio %>"
                placeholder="Ex: Ubatuba"
              >
            </div>
          </div>
        </div>

        <!-- Search Buttons -->
        <div class="flex gap-4">
          <button type="submit" class="btn btn-primary">
            Buscar
          </button>
          <a href="/" class="btn btn-secondary">
            Limpar Filtros
          </a>
        </div>
      </form>
    </section>

    <!-- Results Count -->
    <div class="mb-4 flex items-center justify-between">
      <p class="text-gray-700">
        <% if (pagination.total > 0) { %>
          Encontrados <strong><%= pagination.total %></strong> resultado<%= pagination.total !== 1 ? 's' : '' %>
          <% if (pagination.totalPages > 1) { %>
            (página <%= pagination.page %> de <%= pagination.totalPages %>)
          <% } %>
        <% } else { %>
          Nenhum resultado encontrado
        <% } %>
      </p>

      <% if (results.length > 0) { %>
        <p class="text-sm text-gray-600">
          Mostrando <%= results.length %> referência<%= results.length !== 1 ? 's' : '' %>
        </p>
      <% } %>
    </div>

    <!-- Results Grid -->
    <% if (results.length > 0) { %>
      <div class="results-grid">
        <% results.forEach(reference => { %>
          <%- include('partials/result-card', { reference: reference }) %>
        <% }); %>
      </div>

      <!-- Pagination -->
      <% if (pagination.totalPages > 1) { %>
        <%- include('partials/pagination', { pagination: pagination, filters: filters }) %>
      <% } %>

    <% } else { %>
      <%- include('partials/empty-state', { filters: filters }) %>
    <% } %>

  </main>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white py-6 mt-12">
    <div class="container mx-auto px-4 text-center">
      <p class="text-sm">etnoDB - Base de Dados Etnobotânica</p>
      <p class="text-xs text-gray-400 mt-1">
        Dados de comunidades tradicionais seguindo princípios C.A.R.E.
      </p>
    </div>
  </footer>

</body>
</html>
