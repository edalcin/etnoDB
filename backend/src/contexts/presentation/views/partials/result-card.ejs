<article class="result-card">
  <!-- Reference Header -->
  <header class="border-b border-gray-200 pb-3 mb-3">
    <h3 class="text-lg font-semibold text-gray-900 mb-1">
      <%= reference.titulo %>
    </h3>

    <div class="text-sm text-gray-600">
      <p class="mb-1">
        <strong>Autores:</strong> <%= reference.autores.join(', ') %>
      </p>
      <p>
        <strong>Ano:</strong> <%= reference.ano %>
        <% if (reference.DOI && reference.DOI.trim().length > 0) { %>
          | <strong>DOI:</strong> <%= reference.DOI %>
        <% } %>
      </p>
    </div>
  </header>

  <!-- Abstract (if available) -->
  <% if (reference.resumo && reference.resumo.trim().length > 0) { %>
    <div class="mb-3">
      <p class="text-sm text-gray-700 line-clamp-3">
        <%= reference.resumo %>
      </p>
    </div>
  <% } %>

  <!-- Communities Section -->
  <div class="space-y-3">
    <h4 class="text-sm font-semibold text-gray-800">
      Comunidades (<%= reference.comunidades.length %>)
    </h4>

    <% reference.comunidades.forEach(comunidade => { %>
      <div class="bg-gray-50 rounded p-3">
        <!-- Community Info -->
        <div class="mb-2">
          <p class="font-medium text-gray-900"><%= comunidade.nome %></p>
          <p class="text-sm text-gray-600">
            <%= comunidade.municipio %>, <%= comunidade.estado %>
          </p>
        </div>

        <!-- Economic Activities (if available) -->
        <% if (comunidade.atividadesEconomicas && comunidade.atividadesEconomicas.length > 0) { %>
          <div class="border-t border-gray-200 pt-2 mt-2">
            <p class="text-xs text-gray-700">
              <strong>Atividades Econômicas:</strong>
              <%= comunidade.atividadesEconomicas.join(', ') %>
            </p>
          </div>
        <% } %>

        <!-- Observations (if available) -->
        <% if (comunidade.observacoes && comunidade.observacoes.trim().length > 0) { %>
          <div class="border-t border-gray-200 pt-2 mt-2">
            <p class="text-xs text-gray-700">
              <strong>Observações:</strong> <%= comunidade.observacoes %>
            </p>
          </div>
        <% } %>

        <!-- Plants -->
        <% if (comunidade.plantas && comunidade.plantas.length > 0) { %>
          <div class="border-t border-gray-200 pt-2 mt-2">
            <p class="text-xs font-semibold text-gray-700 mb-1">
              Plantas (<%= comunidade.plantas.length %>):
            </p>
            <div class="space-y-2">
              <% comunidade.plantas.forEach(planta => { %>
                <div class="text-xs text-gray-700">
                  <p>
                    <strong class="text-gray-800">Científico:</strong>
                    <%= Array.isArray(planta.nomeCientifico) ? planta.nomeCientifico.join(', ') : planta.nomeCientifico %>
                  </p>
                  <p>
                    <strong class="text-gray-800">Vernacular:</strong>
                    <%= Array.isArray(planta.nomeVernacular) ? planta.nomeVernacular.join(', ') : planta.nomeVernacular %>
                  </p>
                  <p>
                    <strong class="text-gray-800">Uso:</strong>
                    <%= Array.isArray(planta.tipoUso) ? planta.tipoUso.join(', ') : planta.tipoUso %>
                  </p>
                </div>
              <% }); %>
            </div>
          </div>
        <% } %>
      </div>
    <% }); %>
  </div>

  <!-- Reference Footer -->
  <footer class="border-t border-gray-200 pt-3 mt-3">
    <p class="text-xs text-gray-500">
      <% if (reference.createdAt) { %>
        Cadastrado em: <%= new Date(reference.createdAt).toLocaleDateString('pt-BR') %>
        <% if (reference.updatedAt && reference.createdAt && reference.updatedAt.toString() !== reference.createdAt.toString()) { %>
          | Atualizado em: <%= new Date(reference.updatedAt).toLocaleDateString('pt-BR') %>
        <% } %>
      <% } %>
    </p>
  </footer>
</article>
